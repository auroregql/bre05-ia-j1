QUESTION :

Peux tu identifier l'erreur de conception sur ce code stp ? : class Controller extends AbstractController
{
	// ...

	public function home() : void
	{
		$query = $this->db->prepare('SELECT * FROM users');
		$parameters = [

		];
		$query->execute($parameters);
		$result = $query->fetchAll(PDO::FETCH_ASSOC);
	}

	// ...
}


REPONSE : 

Oui ğŸ‘
Ici, il nâ€™y a **pas dâ€™erreur de syntaxe**, mais bien une **erreur de conception (architecture)**.

---

## âŒ Erreur de conception principale

ğŸ‘‰ **Le contrÃ´leur accÃ¨de directement Ã  la base de donnÃ©es.**

```php
$query = $this->db->prepare('SELECT * FROM users');
```

### Pourquoi câ€™est un problÃ¨me

Dans une architecture MVC (ou proche) :

* **Controller** : orchestre la requÃªte (HTTP â†’ rÃ©ponse)
* **Model / Repository / Service** : contient la logique dâ€™accÃ¨s aux donnÃ©es
* **View** : affichage

Ici, le contrÃ´leur :

* prÃ©pare la requÃªte SQL
* exÃ©cute la requÃªte
* rÃ©cupÃ¨re les rÃ©sultats

â¡ï¸ Il mÃ©lange **logique de contrÃ´le** et **logique mÃ©tier / data**

---

## ğŸ§  En termes de principes de conception

### ğŸ”´ Violation du principe de responsabilitÃ© unique (SRP)

Le contrÃ´leur a **deux responsabilitÃ©s** :

1. GÃ©rer lâ€™action `home()`
2. Savoir *comment* rÃ©cupÃ©rer les utilisateurs en base

---

### ğŸ”´ Couplage fort Ã  PDO / SQL

```php
PDO::FETCH_ASSOC
```

* Le contrÃ´leur dÃ©pend directement de PDO
* Impossible de changer :

  * le SGBD
  * le moteur de stockage
  * la source des donnÃ©es
    sans modifier le contrÃ´leur

---

## âš ï¸ Autre problÃ¨me secondaire

```php
$parameters = [];
```

* RequÃªte prÃ©parÃ©e **sans paramÃ¨tres**
* Utilisation inutile de `prepare()` au lieu de `query()`
* Indice dâ€™un code copiÃ© sans intention claire

---

## âœ… Ce qui aurait dÃ» Ãªtre fait (conceptuellement)

* Le contrÃ´leur **appelle un service / repository**
* Le contrÃ´leur **ne connaÃ®t pas le SQL**

Exemples de responsabilitÃ©s correctes :

* `UserRepository::findAll()`
* `UserService::getAllUsers()`

---

## ğŸ§¾ RÃ©sumÃ©

âŒ **Erreur de conception** :

> Le contrÃ´leur accÃ¨de directement Ã  la base de donnÃ©es et contient du SQL.

âœ”ï¸ **ConsÃ©quences** :

* Code moins testable
* Code moins maintenable
* Architecture fragile

ğŸ‘‰ Si tu veux, je peux aussi :

* identifier **toutes** les violations SOLID
* te montrer comment repÃ©rer ce genre dâ€™erreur rapidement en entretien
* analyser le rÃ´le dâ€™`AbstractController`

Dis-moi ğŸ˜Š
